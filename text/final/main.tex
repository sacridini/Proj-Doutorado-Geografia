\documentclass[12pt,a4paper]{article}
\usepackage[utf8]{inputenc}
\usepackage[margin=25mm]{geometry}
\usepackage{natbib}
\usepackage{csquotes}
\usepackage{color}
\usepackage[portuguese]{babel}
\usepackage[shortlabels]{enumitem} % To use letters in enumerate command
\setlength{\parindent}{0pt} % stops paragraph indentation (remove if you want)
\usepackage{graphicx} % add figures
\usepackage[table]{xcolor} % add color to tables
\usepackage[nottoc,numbib]{tocbibind} % add bibliography to the table of contents

\setlength{\parindent}{15pt} % add paragraph space

\begin{document}
% \maketitle

\begin{titlepage}
    \centering
    \vspace*{\fill}

    \vspace*{0.5cm}

    \Large% \bfseries
    Monitoramento de Longo Prazo (1985 - 2018) das Mudanças Florestais na Mata Atlântica Brasileira Utilizando Técnicas de Detecção de Mudança Baseado em Trajetórias

    \vspace*{5cm}

    \large Eduardo Ribeiro Lacerda

    \vspace*{\fill}
\end{titlepage}

\newpage
\tableofcontents

\newpage
\listoffigures

\newpage

\section{Introdução}
\hspace{13pt} A busca por um melhor entendimento dos processos e dinâmicas ocorridas na paisagem passa necessariamente por uma melhor compreensão do tempo \citep{gregory85}. 
A aplicação de técnicas de sensoriamento remoto em séries temporais ao longo das últimas décadas contribuíram para que o avanço da detecção de supressões florestais, sejam as relacionados a processos antrópicos, como a processos naturais, fossem utilizadas como subsídio ao desenvolvimento e a aplicação de políticas públicas conservacionistas e restaurativas. Os esforços pelo monitoramento são multi-escalares, mostrando que a aplicação de técnicas de sensoriamento remoto podem ser utilizadas como subsídio a projetos locais \citep{rs12111815}, regionais \citep{Vancutsemeabe1603, silva_junior_brazilian_2021, brandt_unexpectedly_2020}, nacionais \citep{rs12111790} e até mesmo globais \citep{Hansen850, crowther_mapping_2015, POTAPOV2021112165}. A produção desses insumos contribuem diretamente, por exemplo, para o desenvolvimento de cooperações internacionais viáveis foquem em políticas compensatórias visando a redução dos efeitos da mudança climática. 

No entanto, detectar mudanças na paisagem comparando mapas de uso e cobertura a partir de classificações prévias, tendem a propagar erros e a possuírem custo de produção elevado como o caso de projetos governamentais como o realizado pelo IBGE \citep{ibge2020} ou projetos independentes como o Mapbiomas \citep{Souza2019}. O aumento na disponibilidade de imagens prontas para processamento  \citep{rs12030426} em plataformas como o Google Earth Engine facilitaram a aplicação de abordagens que buscam diminuir custos e facilitar o desenvolvimento de produtos no qual o foco pode estar compreendido no entendimento dos processos, sejam eles de curta quanto de longa duração.

Ao longo dos últimos 10 anos algumas soluções começaram a ser desenvolvidas com o intuito de suprir esta demanda. Algoritmos de detecção de mudança em séries temporais como o Landtrendr foram desenvolvidos e aplicados inicialmente em ambientes de florestas temperadas \citep{KENNEDY2012117}. Desde as primeiras versões do algoritmo até hoje, muitas aplicações foram desenvolvidas em diversas áreas como: distúrbios florestais \citep{rs9050479, rs12223720}, mudanças em áreas urbanas \citep{rs12182883, rs13132438}, distúrbios causados por incêndios \citep{rs12091499, rs12233942}, mineração \citep{rs12101612, rs12142235}, distúrbios em áreas de proteção \citep{rs13091800}, detecção de mudanças ou abandonos de áreas de produção agrícola \citep{YIN201812, rs11101234, KOLECKA2021112340, DARA201849}, entre outros.

Alguns trabalhos em âmbito nacional também foram realizados e buscaram aplicar o algoritmo em áreas tropicais com o objetivo de entender seu comportamento em ambientes de maior diversidade ecológica. No entanto, todos os trabalhos focaram em contextos locais ou espacialmente limitados já que só puderam utilizar a primeira versão do algoritmo, ainda desenvolvido em linguagem proprietária IDL e com processamento exclusivo em ambiente offline, o que limitou significativamente a aplicação do mesmo para áreas extensas. O algoritmo foi aplicado primeiramente em áreas de várzea na floresta amazônica \citep{FRAGAL2016} e depois no contexto de Mata Atlântica em escala municipal \citep{Zebende2020} e estadual \citep{Weckmuller2019}. A partir da implementação do algoritmo na plataforma Google Earth Engine \citep{Kennedy2018}, a utilização do mesmo pode ser democratizada e possivelmente ampliada para extensões de terra maiores ao mesmo tempo que diminuiu o custo de produção do mapeamento, já que todo o processamento pesado passou a ser feito de forma gratuita e centralizada em um servidor online.

Sendo assim, a partir de sua nova implementação surgiram possibilidades de aplicação do algoritmo visando a detecção de mudanças baseadas em trajetórias não só para paisagens locais como para grandes extensões. No entanto, para que sua aplicação seja de fato difundida como ferramenta de suporte à trabalhos de grande escala e que tenham significância para a elaboração de políticas nacionais e regionais, seria necessário entender seu desempenho quando aplicado a um grande grupo de ecossistemas e diferentes fitofisionomias.

Após análise de diferentes possibilidades de aplicação e áreas de estudo, verificou-se que o bioma da Mata Atlântica poderia ser uma excelente e importante área de estudo para buscar o melhor entendimento da técnica proposta. Assim como sua extensão, o bioma possui outros números impressionantes. É na Mata Atlântica onde cerca de 100 milhões de pessoas vivem e também onde 70\% do produto interno bruto brasileiro é gerado, o que em parte explica o fato de hoje apenas cerca de 12\% de sua cobertura natural ter persistido e apenas 30\% dessas serem protegida em unidades de conservação. Apesar da baixa porcentagem de cobertura natural, é o bioma que abriga mais de 15.700 espécies de plantas e mais de 2.200 espécies de vertebrados registrados pela ciência (260-300 mamíferos; 930-990 aves; 200-300 répteis; 370-480 anfíbios; 300-350 peixes). As estimativas variam, mas, de qualquer forma, impressiona que a Mata Atlântica, representando apenas 0.8\% da superfície terrestre do planeta, abrigue cerca de 5\% das espécies de vertebrados e 5\% da flora mundial. Mesmo tratando-se do bioma brasileiro mais estudado, ainda há muito por se descobrir. Entre 1990 e 2006, registraram-se mais de 1.190 novas espécies de plantas na Mata Atlântica, no coração da área urbana da cidade do Rio de Janeiro e novas espécies são encontradas com alguma frequência. Parte expressiva da fauna e da flora da Mata Atlântica é endêmica, ou seja, não ocorre em nenhum outro lugar do planeta. Estima-se que entre 43\% e 45\% do total de espécies de plantas e vertebrados sejam restritas a esse bioma \citep{scarano2014}.

Para o mapeamento do bioma consideramos um intervalo anual que compreendeu todos os anos de 1985 até 2018. A escolha desse período de análise se deu por conta do início da captura de dados iniciado em 1 de março de 1984 pelo satélite Landsat 5 e consequente disponibilidade de dados pela comunidade científica para o mesmo período, o que facilitou a verificação e validação dos resultados. Para cobrir toda a área do bioma foi necessário a compilação e processamento de 88 cenas Landsat, cada uma com cerca de 23 imagens com por ano, o que dá algo em torno de 67 mil imagens. Se considerarmos que cada uma dessas imagens possui pelo menos 7 bandas, chegamos a um cubo multidimensional de quase meio milhão de bandas. Um processamento que sem dúvidas só seria possível com o advento das tecnologias já citadas.

% Foram mapeados apenas áreas com presença de floresta

% falar dos cenários de ganho e perda ? 

\subsection{Questionamentos e objetivos da pesquisa}
Os questionamentos motivadores da pesquisa foram:
\begin{itemize}
    \item Como um algoritmo como o Landtrendr, inicialmente desenvolvido e utilizado para detecção de mudanças em ambientes de floresta temperada poderia ser utilizado para identificar com alta precisão mudanças ocorridas em uma paisagem complexa como a presente na Mata Atlântica brasileira?
    
    \item O aplicação da metodologia consegue boa performance geral e/ou em diferentes fitofisionomias considerando a aplicação do algoritmo com um mesmo conjunto de parâmetros?
    
    \item Quais as áreas com maior quantidade de perda e ganho de floresta?
    
    \item Como as unidades de preservação existentes da Mata Atlântica se comportaram ao longo dos anos? (ex. Parque Nacional da Serra da Bocaina, Parque Nacional da Serra dos Órgãos, etc)
    
    \item Como os estados e municípios se comportaram ao longo da série temporal? Quais deles ganharam mais do que perderam floresta?
    
    \item Quais os anos com maior quantidade de perda e ganho de floresta?
    
    \item Quais as áreas com maior taxa de mudança tanto para perda como ganho de vegetação? 
    
    \item Qual a idade das florestas secundárias do bioma? 
\end{itemize}

\subsection{Objetivos Específicos}
\begin{itemize}
    \item Definição do período, seleção das imagens e criação da composição da série temporal Landsat a ser utilizada;
    
    \item Compatibilização das imagens utilizadas de acordo com características geométricas e radiométricas com o intuito de evitar possíveis ruídos;
    
    \item Definição dos parâmetros e do índice espectral para a execução do processo de segmentação temporal utilizando o algoritmo Landtrendr;
    
    \item Desenvolvimento do código na plataforma Google Earth Engine para a execução do algoritmo em todas as cenas que englobam o bioma da Mata Atlântica brasileira;
    
    \item Mapeamento das trajetórias florestais compatível com a escala 1:100.000 através da criação de mapas de detecção de magnitude, ano de início da mudança, duração e taxa de mudança;
    
    \item Conversão dos dados matriciais gerados em dados vetoriais com intuito de identificar áreas com maior nível de ocorrência de perdas e ganhos de acordo com divisões políticas e geoecológicas;
    
    \item Mapeamento da idade da floresta secundária;
    
    \item Avaliação da acurácia dos produtos gerados. Avaliar o desempenho do algoritmo em ambientes de florestas tropicais com alto nível de complexidade ecológica.
\end{itemize}
\newpage

\section{Perspectivas sobre a Utilização de Algoritmos para o Processamento de Séries Temporais no Estudo de Distúrbios Florestais}

\subsection{Introdução}

\hspace{13pt} A incorporação do tempo como variável chave de estudos geográficos, principalmente os pautados na análise sistêmica da paisagem, se deu de forma bastante limitada principalmente pela dificuldade de acesso a séries históricas confiáveis, assim como pela dificuldade de manipulação das mesmas quase sempre através de um ambiente computacional também limitado.

Com o aumento significativo do uso da internet e da capacidade de hardware das últimas décadas, a utilização de métodos computacionais na análise de dados científicos se tornaram cada vez mais presentes com uma maior possibilidade de acesso não só a grandes bases de dados como também a ambientes computacionais de alto desempenho. Essa realidade passou a ser possível para um público que antes dependia quase que exclusivamente das estruturas disponíveis mais próximas e imediatas. Isso representa uma mudança significativa para pesquisadores de países onde o acesso as estruturas científicas quase sempre se dão de forma mais limitada. Consequentemente, isso se traduz na possibilidades de estudos não só mais detalhados e estruturados como também de pesquisas que abordem outras escalas de análise, o que por sua vez possibilita uma maior relevância científica internacional e maior reprodutibilidade dos estudos \citep{ArribasBel2018}.

A aplicação de técnicas de análise de séries temporais para o monitoramento espaço-temporal da paisagem tem surgido com maior força nos últimos anos como consequência dessa evolução histórica. A aplicação dessas técnicas é da mais diversa possível, vindo inicialmente quase que exclusivamente dos estudos econométricos e de poucas outras áreas científicas para a sua massificação em muitas outras áreas. Uma delas, e que será abordada neste trabalho é a utilização de técnicas de análise de séries temporais em imagens digitais orbitais com o intuito do monitoramento de áreas naturais florestadas, principalmente na detecção de distúrbios florestais. Esse tipo de aplicação vem ganhando força não só pelo entendimento das mudanças da paisagem e suas dinâmicas, como também pela preocupação com o monitoramento do desmatamento, monitoramento de projetos de restauração e também no acompanhamento de processos de regeneração natural que acontecem na paisagem. O monitoramento do uso do solo nunca teve tanta importância como hoje devido ao maior entendimento e comprometimento internacional em relação as variáveis influenciadoras do processo da mudanças climáticas através de tratados e acordos de estimulo à conservação e restauração de áreas naturais \citep{ALMEIDA201934}, entendendo ainda o protagonismo da análise espacial e do monitoramento por satélites como ferramenta essencial neste processo \citep{WHITE2019}. 

Políticas de REDD+, assim como vários esforços de cooperação internacional como os propostos pelo Bonn Challenge e os Aichi Targets deficidos pela CDB (\textit{Convention on Biological Diversity}), tem como ferramenta principal a incorporação de técnicas de sensoriamento remoto para o monitoramento do cumprimento dos objetivos, sendo então diretamente vinculados ao entendimento do comportamento da paisagem no tempo \citep{BOS2019295, CROUZEILLES2019}. Estudos mais recentes vem demonstrando que os processos de degradação em florestas tropicais tem impacto similar ou até mesmo maior em relação as emissões de carbono que o desmatamento das mesmas \citep{Harris1573, Houghton2012, Grace2014}. É importante notar aqui que a utilização do termo distúrbio é diferente do de degradação. Enquanto distúrbio está associado a um único evento que pode ser tanto natural como antrópico, degradação se associa a um processo temporalmente maior de perda de biomassa e a um tipo de influência necessariamente antrópica se considerarmos a definição do IPCC (\textit{Intergovernmental Panel on Climate Change}) ou não necessariamente antrópica caso se considere a definição da FAO (\textit{Food and Agriculture Organization of the United Nations}) \citep{Hirschmugl2017}. 

Além disso, outros estudos demonstram que as florestas tropicais tem sofrido mais pressões do que as temperadas. Um terço das florestas tropicais já foram perdidas para o desmatamento, e da área restante, 46\% da área está fragmentada, 30\% degradada e apenas 24\% ainda permanece em estado mais preservado. Sabendo disso, fica ainda mais clara a necessidade de entender quais as melhores técnicas que podem ser utilizadas para o monitoramento destes processos \citep{Hirschmugl2017}. 

O momento político e histórico de acordo com a perspectiva da preservação do meio ambiente na qual estamos inseridos necessita ainda mais que as pesquisas de monitoramento de distúrbios sejam feitos de forma cada vez mais transparente e acessíveis a todos para que processos de degradação sejam detectados a tempo. Com isso, é importante entendermos quais tecnologias estão disponíveis e quais as possibilidades de monitoramento são possíveis, tendo como objetivo principal entender não só suas potencialidades como suas limitações. 

Sendo assim, este trabalho tem como objetivo a apresentação e análise das características dos principais algoritmos de detecção de distúrbios, principalmente os especializados na detecção de mudanças em áreas florestadas, seja na perda como no ganho de biomassa.


\subsection{Breve Histórico}

\hspace{13pt} Estudos espaço temporais com o objetivo de detecção de mudanças não são novos na área do sensoriamento remoto. A tradicional análise bi-temporal de dados previamente classificados ainda é presente em muitos estudos atuais. No entanto, esse tipo de estudo tende a conter um número maior de erros, já que quanto maior o número de imagens analisadas, maior a quantidade de mapas com erros de classificação associados que serão levados em consideração. De qualquer forma, estes tipos de estudos tendem a ser o que possuem menor requisito de poder computacional, já que necessitam apenas de operações simples entre álgebra de bandas.

Com o tempo, o maior poder computacional disponível não só para o processamento como para o armazenamento de dados possibilitou que outras técnicas mais elaboradas pudessem ser implementadas, onde ao invés de apenas algumas imagens serem consideradas, todas as imagens da série temporal são levadas em consideração. Isso possibilitou também que muitas técnicas de análise de séries temporais tipicamente aplicadas principalmente na área de econometria pudessem ser utilizadas em estudos geoespaciais.

O processamento de imagens de satélite que historicamente sempre foi feito através do processamento de pixels individuais, passou a partir da década de 00 a ser feita em muitos casos através do delimitação de objetos com a popularização das imagens de alta-resolução espacial e consequentemente das técnicas de GEOBIA (\textit{Geographic Object-Based Image Analysis}). As análises pixel à pixel que pareciam estar cada vez mais em desuso, acabaram ressuscitando nos últimos anos devido a capacidade de processamento de séries temporais densas. A densidade da série é um ponto chave para esse retorno, já que para que a análise temporal seja bem sucedida e para que os algoritmos aplicados possam entender ainda melhor os processos ocorridos no tempo, é necessário que os dados utilizados tenham resolução temporal condizente com o que se quer detectar. No caso da utilização de imagens de satélite isso se torna um limitador importante, já que a disponibilidade de satélites imageadores historicamente nunca foi alta e tem custo extremamente elevado quando comparado a outros tipos de sensores. Outro problema é que os satélites possuem um tempo de revisita que em muitos casos não possibilitam que uma série mais densa possa ser estruturada. 
%\par
Além disso, problemas como a presença de nuvens, assim como ruídos na própria imagem e a heterogeneidade da distribuição solar no planeta e sua interação com o relevo dificultam ainda mais esse processo ao criar sombras. No entanto, com o tempo, outros satélites foram sendo desenvolvidos e propositalmente pensados com o objetivo de incorporar as séries de imagens já existentes derivadas de projetos antigos com os recém lançados. Um exemplo disso foi o lançamento da série Sentinel 2 (A e B) pela Agência Espacial Europeia com uma resolução espectral e espacial similar as encontradas na série Landsat, o que possibilita uma fusão entre imagens de satélites diferentes com o objetivo de aumentar a densidade de imagens. Com isso, tanto a disponibilidade de dados como a resolução temporal dos satélites ganharam nova relevância. A disponibilização de imagens de forma gratuita, assim como a preocupação com a manutenção de séries históricas e o desenvolvimento de constelações que diminuam a resolução temporal acabaram possibilitando esse retorno do pixel como chave analítica central no sensoriamento remoto.


\subsection{Técnicas e Algoritmos para a Análise Temporal de Áreas Florestadas}
\hspace{13pt} Analisar áreas florestadas sob uma perspectiva temporal possibilita a identificação de processos e padrões que uma simples caracterização espectral mais tradicional não é possível de identificar devido a limitações ligadas a resolução espacial, radiométrica e espectral. Sendo assim, ao incluir a dimensão temporal, é possível entender dinâmicas como a supressão da floresta em um dado momento, assim como também os distúrbios naturais e degradações de origem antrópica ao longo do tempo.
A degradação associada ao desmatamento e posterior uso agrícola da terra, seguido do abandono e consequente retorno da vegetação através de processos de regeneração natural, ou então um processo de degradação mais lento, como a extração seletiva de madeira, são exemplos de mudanças no uso e cobertura da terra que só podem ser compreendidos através de técnicas como as que serão mostradas neste trabalho. 

Técnicas de detecção de mudança possuem uma longa história na área de sensoriamento remoto. Desde as primeiras aplicações utilizando sensores TM do satélite Landsat 5 na década de 1980 e 1990, muitos estudos foram feitos. Inicialmente os estudos visavam majoritariamente na aplicação de técnicas mais tradicionais como o mapeamento das áreas de interesse utilizando técnicas tradicionais de classificação de imagens tanto de forma supervisionada como não supervisionada e posterior cálculo da diferença entre as duas ou mais imagens. Neste caso, somente métricas como o ganho e perda de área e sua consequente espacialização poderiam ser extraídas e visualizadas. No entanto, com o aumento do poder computacional e consequente amadurecimento das técnicas, softwares e bibliotecas disponíveis, o processamento de dados multi-temporais passaram a ser entendidos em sua totalidade. Ou seja, com a aplicação de técnicas menos reducionistas. O que isso significa na prática é que a análise de mudanças de áreas de floresta passou a ser feita através da manipulação tanto da criação de composições anuais, assim como intra-anuais e também da análise de toda a série temporal sem maiores cortes.

Para o processamento de séries temporais utilizando imagens de satélite é necessário se preocupar também com o pré processamento das mesmas para que a aplicação do algoritmo, seja ele qual for, não influencie o resultado final com ruídos derivados de falta de calibração geométrica entre as imagens de diferentes datas, assim como a variação radiométrica, além da presença de possíveis sombras. Para isso, é necessário utilizar técnicas de pré-processamento como a ortorretificação e a correção radiométrica (atmosférica) das imagens. Dependendo do satélite utilizado é possível utilizar métodos implementados pela própria agência distribuidora, o que é bastante recomendado. No caso da correção geométrica das imagens, muitas já são disponibilizadas após serem tratadas automaticamente por método de correção subpixel \citep{Gutjahr2014}. Já para a correção radiométrica existem dois tipos: as calibração absoluta e a relativa. A absoluta faz a calibração transformando os valores digitais em valores físicos de superfície e aplicando algoritmos como o 6S \citep{Sagan2004}, já a calibração relativa utiliza uma imagem de referência como base e aproxima os valores do resto da série de acordo com a imagem base. Trabalhos comparando os dois métodos já foram desenvolvidos utilizando imagens Landsat e apresentam resultados similares \citep{Chen2010}. Produtos da série Landsat ainda possuem métodos internos de correção além de máscaras para a filtragem de nuvens, sombras e outras características das imagens \citep{ZHU2015269, ZHU201283, Huang2010}, o que facilita bastante a etapa de pré-processamento.

Alguns algoritmos foram sendo desenvolvidos ao longo dos últimos anos com o objetivo de lidar melhor com essas séries. Um dos mais tradicionais é o BFAST \sloppy  \citep{VERBESSELT2010106, VERBESSELT20102970, VERBESSELT201298} que possui uma versão visando dados espaciais denominada bfastSpatial \citep{bfastSpatial}. As duas ferramentas possuem o mesmo algoritmo de detecção, mas a versão espacial se diferencia por conta de uma série de funções voltadas para facilitar o pré-processamento dos dados com o intuito de construir inicialmente a série temporal. A construção das séries temporais em ambiente offline sem ajuda de ferramentas mais modernas é, de fato, bastante trabalhosa e contém muitas etapas necessárias para que a análise final possa ser feita sem maiores problemas e sem a geração de ruídos por conta de dados de entrada problemáticos. É importante notar também que as duas ferramentas, diferentemente de outros algoritmos que serão analisados neste trabalho, não são voltados exclusivamente para a detecção de distúrbios em ambientes florestais,  mas sim em basicamente qualquer outro tipo de uso. No entanto, o uso das duas ferramentas em ambientes florestais é provavelmente o mais comum entre os trabalhos existentes. 

O BFAST tem como ideia geral analisar a série temporal de imagens analisando os valores pixel à pixel e detectando quebras (\textit{breakpoints}) de pixels que tenham valor discrepante do valor médio esperado. É possível detectar mais de uma quebra em uma mesma série de pixels, o que é interessante principalmente para análise de usos agrícolas, assim como quando comparados a áreas florestais. O algoritmo ainda pode ser utilizado em objetos, como apresentado por Siti Latifah \citep{LATIFAH2016}, onde a integração com técnicas de GEOBIA apresentou ótimos resultados. Este resultado demonstra ainda um novo potencial a ser explorado, onde a integração de dois paradigmas (pixel/objeto) através do processamento de séries temporais pode trazer novas formas de análise e até mesmo a implementação de novos algoritmos.

Já outros trabalhos utilizando o BFAST demonstraram a capacidade do mesmo na detecção de quebras para a caracterização de distúrbios cíclicos em florestas com o objetivo de explicar mudanças estruturais que acabam influenciando diretamente na qualidade da floresta presente e não só na sua simples presença ou não presença \citep{JAKOVAC2017, DUTRIEUX2016112}.

Mais recentemente, o BFAST passou por um processo de reimplementação, deixando a linguagem R de lado como em sua versão original e sendo totalmente reprogramado utilizando a linguagem Python. Essa mudança se deu pela fato da nova versão possuir uma integração direta com a biblioteca de processamento paralelo OpenCL, o que garantiu uma diminuição no tempo total de processamento em duas ordens de grandeza \citep{Gieseke2020}. Por utilizar um padrão aberto de paralelismo, a nova implementação possui a capacidade de poder se beneficiar do paralelismo independente do tipo e do fabricante do hardware, podendo ser paralelizado tanto na CPU (Intel/AMD) quando na GPU (Nvidia, AMD, Intel).

Além do BFAST, outras implementações computacionais foram desenvolvidas com o objetivo de analisar séries temporais para detecção de padrões em tipos variados de uso do solo. Este é o caso do Timesat \citep{Jnsson2004TIMESATA}. O Timesat, apesar de ter a aplicação mais voltada para a caracterização de tipos de culturas agrícolas através da interpretação da série, também possui uso na caracterização de tipos e também de distúrbios em florestas \citep{Wenbo2017}. O Timesat ainda possui diversas ferramentas internas para o tratamento de ruídos, tratamento de dados faltantes e composição de séries sazonais utilizando algoritmos como o Savitzky-Golay \citep{Savitzky1964}.

Ao aprofundarmos mais, para além das técnicas mais tradicionais, podemos entender que esses algoritmos apresentados, assim como muitos outros existentes se diferenciam entre si. Além disso, alguns deles acabam sendo desenvolvidos como algoritmos especialistas na aplicação de detecção de distúrbios em florestas, ao contrário dos algoritmos já citados. Esses novos métodos de análise ainda podem ser categorizados em quatro sub-categorias: algoritmos baseados na detecção de mudanças baseados em limiares, os baseados em ajude de curvas, os baseados no ajude de trajetórias e os baseados na segmentação de trajetórias \citep{Banskota2014, Hirschmugl2017}.

\subsection{Detecção de Mudanças Baseado em Limiares}
\hspace{13pt} Os métodos de detecção baseados em limiares funcionam buscando a diferenciação de áreas de floresta e não floresta, e posteriormente separando áreas de floresta "intacta" das que sofreram algum tipo de distúrbio ou processo de degradação. A ideia é utilizar uma série temporal previamente tratada formadas tanto puramente por índices de vegetação, como pela integração de diversas bandas espectrais e bandas sintéticas derivadas de estatísticas da própria série. Esses métodos possuem um grande potencial e aplicação, mas ao mesmo tempo tem como ponto negativo a necessidade da delimitação empírica de limiares, o que dificulta bastante a replicabilidade dos trabalhos.

\subsection{Detecção de Mudanças Baseado no Ajuste de Curvas}
\hspace{13pt} A utilização de métodos baseados no ajuste de curvas em áreas florestadas tem como objetivo entender o comportamento espectral primeiramente aplicando uma linha de regressão, onde dependendo da inclinação da mesma é possível detectar a presença ou ausência de mudanças significativas. Além disso, o sinal da inclinação determina também o ganho ou perda de biomassa. O lado negativo desse método é a necessidade da suposição de uma certa normalidade entre os dados de entrada, o que em sensoriamento remoto é quase sempre muito difícil de se obter. Isso já tende a limitar a aplicação de métodos como esse a sensores com menor resolução temporal como os presente no projeto MODIS (\textit{Moderate-Resolution Imaging Spectroradiometer}), ou então de composições muito bem estruturadas de sensores como o Landsat. A utilização desse método pode ser exemplificado pelo trabalho desenvolvido no bioma amazônico utilizando imagens MODIS onde é demonstrado a relação entre o corte seletivo e a mudança da resposta fenológica da vegetação na região ao longo do tempo \citep{KOLTUNOV20092431}.

\subsection{Detecção de Mudanças Baseado no Ajuste de Trajetórias}
\hspace{13pt} As técnicas de ajuste de trajetórias se diferenciam dos anteriores por analisarem as mudanças a partir de trajetórias idealizadas. Através da aplicação de métodos comparativos (ajuste) entre a série estudada com a de referência, seja através do cálculo da distância euclidiana como pela utilização de métodos mais complexos como o DTW (\textit{Dynamic Time Warping}) \citep{VELICHKO1970223, SakoeChiba71, Berndt1994} e sua versão para a classificação de uso do solo, o TWDTW (\textit{Time-Weighted Dynamic Time Warping}) \citep{Maus2016, Maus2019}, o ajuste de trajetórias funciona como um método de análise supervisionado já que depende de amostras de "treino" para a obtenção de resultados satisfatórios.

Este tipo de algoritmo, devido a sua natureza de carácter supervisionado, tem sido utilizado principalmente em estudos aplicados na tipificação de culturas agrícolas, onde a diferenciação dos alvos só pode ser feita utilizando conhecimentos relativos ao comportamento espectral do alvo no tempo. Este tipo de algoritmo necessita de uma densidade de imagens maior que as outras técnicas, já que é necessário o maior grau possível de precisão na série para encaixar e detectar as características entre as duas séries. Para este tipo de aplicação são utilizados normalmente imagens derivadas do sensor MODIS, devido a sua resolução temporal e as suas aplicações na caracterização do comportamento espectral de grandes áreas agrícolas, onde a resolução espacial do satélite (250m) não impede a análise de ser realizada. É possível utilizar imagens Landsat com este método, mas é necessário acumular uma grande densidade de imagens através da fusão do histórico de vários sensores e/ou trabalhando com área de interseção entre path/row diferentes, o que limita sua aplicação \citep{Bendini2016}. Além dessas limitações, outros desafios vem sendo enfrentados em relação a dificuldade de detecção de distúrbios pontuais de corte seletivo e posterior regeneração natural do local, já que amostras muito bem definidas para este tipo de distúrbio precisam ser coletadas. No entanto, exemplos de aplicação em florestas tropicais são presentes \citep{Hirschmugl2013, KENNEDY2007370}.


\subsection{Detecção de Mudanças Baseado na Segmentação de Trajetórias}
\hspace{13pt} O método de segmentação de trajetórias pode ser exemplificado pelo algoritmo Landtrendr \citep{KENNEDY20102897, KENNEDY2012117}, que funciona dividindo a série temporal em segmentos para posterior estudo. Este tipo de abordagem favorece estudos onde em uma mesma série (pixel) é possível entender vários processos. É possível não só a detecção de distúrbios em períodos de tempo curtos (provável evento de desmatamento), assim como na detecção de distúrbios de longo prazo (possível processo de degradação/corte seletivo), como processos de regeneração com longa duração (regeneração natural) e de curto prazo (floresta plantada e projetos de reflorestamento). Esses segmentos são realizados a partir da estipulação de vértices durante a série. Os vértices representam os pontos da série onde houve algum tipo de mudança na qual o algoritmo considerou relevante. A escolha da relevância para a criação de um vértice (quebra) é feita de acordo com regras pré-definidas pelo usuário. Outra vantagem desse método é a possibilidade de análise sem a necessidade de amostras de eventos exemplo como no caso dos algoritmos de ajustes de trajetórias.
No entanto, o método de segmentação de trajetórias também possui suas desvantagens. A principal é que o algoritmo desconsidera efeitos sazonais da vegetação. Além disso, é um método que apesar de possuir alguns trabalhos aplicando suas técnicas em florestas temperadas \citep{PFLUGMACHER2012146, Griffiths2015}, ainda possui poucos estudos em áreas tropicais.

\subsection{Exemplos de Ferramentas e suas Características}
\hspace{13pt} Além do BFAST e de outros algoritmos/softwares apresentados previamente, podemos listar brevemente alguns outros algoritmos de detecção automática de mudanças. É importante notar que alguns desses na verdade não realizam exatamente o trabalho de detecção da mudança, mas sim mais um processo de predição dessas mudanças, já que trabalham a partir de técnicas de regressão. Algumas características e particularidades de cada algoritmo também serão apresentadas. Todos foram desenvolvidos nos últimos anos e representam grande parte dos métodos de detecção automática de distúrbios presentes na literatura recente. São eles: 

\begin{itemize}
  \item \textbf{CCDC} - \textit{Continuous Change Detection and Classification} \citep{ZHU2014152} - O CCDC apresenta funções de análise de séries temporais utilizando não composições anuais ou intra-anuais, mas sim toda a série de imagens de entrada, o que o difere da maioria dos algoritmos exemplificados aqui. O CCDC funciona apenas com imagens sem a presença de nuvens e sombra e busca encontrar padrões de sazonalidade, tendências e quebras na série. Uma característica interessante do CCDC é que o algoritmo é capaz de gerar imagens "sintéticas" para qualquer data presente na série de entrada \citep{ZHU201567}. Estas imagens sintéticas geradas são utilizadas obrigatoriamente como dado de entrada por algoritmos como o MIICA e o ITRA e também podem ser utilizadas opcionalmente por algoritmos como o Landtrendr e o VCT, ao invés de utilizar as imagens originais com valores de reflectância da superfície. O CCDC é utilizado para a detecção de eventos de grande magnitude, sendo então limitado na detecção de processos de degradação, por exemplo. No entanto, pode ser utilizado na detecção de mudanças de vários tipos de uso do solo e não somente na deteccão de distúrbios florestais.
  
  \item \textbf{COLD} - \textit{Continuous Monitoring of Land Disturbance} \citep{Cohen2020} - O COLD é baseado no CCDC com o objetivo de melhorar a detecção de distúrbios florestais. Diferente do CCDC que detecta mudanças baseadas em eventos de grande diferença espectral, o COLD possui a capacidade de detecção de mudanças mais sutis, o que lhe garante suprir essa deficiência presente no CCDC.
  
  \item \textbf{LandTrendr} \citep{KENNEDY20102897, KENNEDY2012117} - O Landtrendr, desenvolvido pelo Environmental Monitoring, Analysis and Process Recognition Lab da Universidade de Oregon, também trabalha tanto com composições de imagens com valores de reflectância da superfície como com imagens sintéticas geradas pelo CCDC. O algoritmo necessita que as imagens não possuam interferência de nuvens e sombras e gera seus dados de saída através da aplicação da técnica de segmentação de trajetórias. O Landtrendr pode gerar saídas como métricas tanto para distúrbios de perda como de ganho, além de detectar se as mudança ocorreram de forma lenta ou rápida, possibilitando também o cálculo da duração dos eventos segmentados previamente gerando não só dados contínuos como a magnitude, assim como dados discretos como a durança e o ano da detecção. É certamente um dos algoritmos com maior quantidade de informação gerada por rodada, o que facilita em muito sua utilização. Outra vantagem do Landtrendr é que apesar de ter sido implementado inicialmente utilizando a linguagem de programação proprietária IDL em um ambiente bastante complicado de manuseio através do software ENVI, foi recentemente implementado diretamente na plataforma online Google Earth Engine \citep{GORELICK201718}, o que veio a facilitar e muito sua utilização pela comunidade \citep{Kennedy2018}. A conversa do algoritmo para a plataforma online do Google possibilitou ainda que o tempo de processamento do mesmo fosse reduzido significativamente. No entanto, a plataforma restringe o processamento para no máximo a área equivalente de uma imagem Landsat por vez.
  
  \item \textbf{VCT} - \textit{Vegetation Change Tracker} \citep{Huang2010, THOMAS201119} - O VCT utiliza composições sem nuvem de imagens com valor de reflectância da superfície, ou de composições sintéticas geradas pelo algoritmo CCDC e extrai uma métrica de similaridade a áreas de floresta intacta. O algoritmo prediz os distúrbios detectando padrões que se afastam da métrica de similaridade.
  
  \item \textbf{EWMACD} - \textit{Exponentially Weighted Moving Average Change Detection} \citep{Brooks2014} - Este algoritmo foi desenvolvido com o objetivo de detectar apenas distúrbios florestais ao analisar o resíduo entre o pixel observado e os valores derivados de uma predição gerado por um processo de regressão harmônica \citep{Brooks2012}. Além disso, tem como característica, assim como o CCDC, utilizar todas as imagens de entrada ao invés de composições. Também possui uma série de funções e parâmetros para a detecção de mudanças de pouca magnitude e de longo prazo, apresentando bons resultados na detecção de processos de degradação.
  
  \item \textbf{VerDET} - \textit{Vegetation Regeneration and Disturbance Estimates through Time} \citep{Hughes2017} - O VerDET funciona através da entrada de composições anuais sem nuvem com valores de reflectância de superfície que são segmentadas se baseando em técnicas de regressão utilizando redes neurais artificiais. Para cada pixel o slope é calculado e são posteriormente interpretados como áreas de distúrbio, estabilidade e regeneração, além de apresentar as magnitudes para a interpretação e classificação entre eventos rápidos ou lentos. Assim como o EWMACD, o VerDET também foi desenvolvido para trabalhar apenas com detecção de distúrbios em florestas.
  
  \item \textbf{MIICA} - \textit{Multi-index Integrated Change Analysis} \citep{JIN2013159} - Este algoritmo utiliza a composição de imagens sintéticas como entrada e tem como característica realizar sua análise baseado em limiares em invervalos bi-anuais. O MIICA analisa as mudanças espectrais de magnitude baseado nesses limiares utilizando quatro índices diferentes (NBR - \textit{Normalized Burn Ratio}, NDVI - \textit{Normalized Difference Vegetation Index}, \textit{Change Vector} e o \textit{Relative Change Vector Maximum}). Pode detectar mudanças relacionadas ao ganho e perda de biomassa e também a cenários de não mudança. É voltado para a detecão de grande magnitude e pode ser utilizado para a detecção de mudança em vários tipos de uso do solo.
  
  \item \textbf{ITRA} - \textit{Image Trends from Regression Analysis} \citep{VOGELMANN201292} É outro algoritmo que utiliza composições anuais sem nuvem geradas sinteticamente pelo CCDC. O ITRA ainda divide a série em três períodos e compara as mesmas com um modelo de regressão linear. É um algoritmo que tem como ênfase a detecção de distúrbios de longo período tanto em florestas como em áreas com vegetação arbustiva. Devido a sua característica de poder identificar mudanças de diferentes magnitudes, o ITRA pode ser utilizado detecção não só de distúrbios em florestas como também em outros tipos de vegetação.
  
  \item \textbf{Shapes-NBR} \citep{Meyer2013, Moisen2016} Como o nome já demonstra, este algoritmo funciona através da composição de uma série temporal de índices NBR, o que difere de sua aplicação original, onde era utilizado apenas como um preditor de mudanças em áreas florestadas e chamado apenas de Shape \citep{SCHROEDER2017230}. O algoritmo funciona para cada pixel aplicando um algoritmo de regressão aditiva semi-paramétrico fornecendo uma trajetória suavizada restrita para se comportar de uma maneira ecologicamente sensíveis. Assim como o Landtrendr, este também gera resultados de acordo com as formas encontradas como o ano da detecção, magnitude da mudança, valores prévios à mudança e posteriores a mesma e taxas de crescimento ou recuperação.
  
\end{itemize}

\subsection{Validação de Séries Temporais}
\hspace{13pt} O processo de validação de séries temporais se difere dos adotados em estudos de mapeamento de apenas uma ou poucas datas de estudo. Normalmente as amostras de validação são extraídas de apenas uma única data e comparada ao resultado obtido, no entanto, no caso do processamento de séries temporais, muitas datas ou até mesmo toda uma série de imagens são utilizadas como dado de entrada para os algoritmos preditores. Sendo assim, o método tradicional perde sua validade. É necessário analisar toda a série de imagens utilizadas para entender os momentos de possível quebra e consequente detecção do distúrbio para podermos validar com maior clareza. Principalmente em situações onde houve distúrbios florestais que aconteceram em um determinado momento histórico e que posteriormente iniciaram um processo de regeneração natural ou então uma mudança para um terceiro uso do solo. Quanto maior a quantidade de tipos de mudança ocorridos durante o tempo analisado, maior a complexidade e consequente necessidade de utilização de métodos de validação apropriados.

Um dos métodos mais utilizados atualmente na validação de séries temporais, independentemente do algoritmo que foi utilizado para a detecção das mudanças é o TimeSync \citep{COHEN20102911}.O TimeSync possui versão offline utilizando uma interface gráfica onde é possível visualizar não somente uma imagem/data, mas toda a série temporal tanto em forma de gráfico como com miniaturas de imagens referentes a área próxima na qual o pixel está sendo analisado. Além disso, após a implementação do algoritmo Landtrendr na plataforma Google Earth Engine, é possível exportar os dados para validação diretamente da plataforma online.  O TimeSync funciona recebendo uma lista de coordenadas na qual ele utiliza para exportar pequenas imagens com um buffer da coordenada analisada para cada ano da série. O software utiliza uma interface gráfica para apresentar uma imagem por ano para cada coordenada e assim possibilitar que o pesquisador faça a validação visual de cada local ao longo do tempo. 

\subsection{Novas Perspectivas}
\hspace{13pt} Com a possibilidade de uso de diversos algoritmos e tipos de análise disponíveis, a escolha por um único método de análise pode ser problemática. Trabalhos desenvolvidos com o objetivo de comparação entre os algoritmos também podem ser problemáticos já que muitos dos algoritmos não se propõe exatamente ao mesmo tipo de análise. No entanto, é possível encontrar trabalhos que vem trabalhando uma integração dos mesmos com o objetivo de encontrar o melhor resultado possível. O trabalho proposto por \citep{HEALEY2018717} buscou integrar todos os oito algoritmos citados neste trabalho junto a outros dados de entrada como o próprio conjunto de imagens com valores de reflectância da superfície, relevo e um mapa temático com os tipos de vegetação presente nas cenas. Todos os dados de entrada foram então processados e classificados utilizando uma implementação do Random Forest \citep{Breiman2001}. Vários resultados foram gerados utilizando todos os dados de entrada assim como variações de combinação entre eles: resultados utilizando somente imagens Landsat, utilizando somente o resultado da combinação de todos os oito algoritmos preditivos, todos os algoritmos combinado as imagens landsat, entre outros. O resultado que acabou representando a menor quantidade de erros foi justamente o que levou em consideração todos os dados de entrada possíveis.

Outro estudo ainda mais recente desenvolvido por \citep{BULLOCK2019111165} também buscou analisar distúrbios florestais integrando vários algoritmos apresentando ótimos resultados. Além disso, implementações feitas utilizando somente algoritmos com o Random Forest analisando séries temporais de imagens Landsat junto a camadas derivadas de estatísticas simples foram realizadas e também obtiveram resultados promissores \citep{WANG2019474}.
Estudos como os citados demonstram que apesar do bom resultado obtido individualmente, os algoritmos de detecção estudados possuem um potencial ainda maior de resultados ainda melhores quando integrados ou entre si e/ou utilizando técnicas híbridas. Além disso, não é possível dizer que um algoritmo ou técnica seja melhor que outra. Cada técnica apresenta pontos positivos e negativos dependendo do tipo de análise a ser realizada.

\subsection{Conclusão}
\hspace{13pt} Ao analisar as opções de algoritmos disponíveis entendendo melhor suas características positivas e negativas, assim como outras possibilidades de implementação das análises de séries temporais de forma integrada, podemos compreender melhor o potencial da pesquisa na área. O desenvolvimento de soluções de monitoramento de distúrbios e de processos de degradação assim como de regeneração, restauração e conservação de áreas de interesse tem alavancado ainda mais a aplicabilidade dos acordos nacionais e internacionais que são mais do que nunca necessários para criar pressões políticas e econômicas buscando resultados reais. Sendo assim, o revisão de conceitos e tecnologias apresentados neste trabalho espera ter contribuído para uma atualização da comunidade científica em relação ao tema abordado.

\newpage
\section{Detecção de Áreas de Florestas Pseudo-Invariantes em Séries Temporais Utilizando Algoritmo Random Forest}

\subsection{Introdução}

\hspace{13pt} O monitoramento remoto da paisagem se estabeleceu em nossa sociedade como uma das principais formas de planejamento estratégico e como uma ferramenta importante para a quantificação de recursos e execução de políticas públicas. Os programas de monitoramento de queimadas e de desmatamento ilegal ganham cada vez mais espaço nos noticiários recentes não somente devido a clara relevância dos resultados obtidos, mas também porque seus resultados repercutem diretamente em muitos dos acordos comerciais que os países tem a possibilidade de realizar. 

Dentre todas as possibilidades de uso de ferramentas de sensoriamento remoto para a detecção de mudanças da paisagem, a detecção de mudanças em áreas florestadas focando em eventos de supressão tem um papel importante e possivelmente é uma das mais estudadas e com maior foco na área. Além dos motivos apontados anteriormente, os dados de monitoramento das supressões ocorridas nessas áreas podem ser usados também como dado de entrada para análises que visam a priorização espacial de áreas estratégicas para a conservação e, mais recentemente, para a restauração de áreas com histórico de supressão. Projetos como o Mapbiomas \citep{Souza2019} realizam o mapeamento sistemático do uso do solo para todo o território nacional e a detecção de mudanças de uso ao longo do período do mapeamento (1985 – 2018), sendo um exemplo de como a área de geotecnologias pode se beneficiar com o aumento do acesso à computação de alto desempenho. 

Além disso, devido a esse aumento do poder computacional e de seu acesso, novos algoritmos visando a análise de séries temporais, utilizando imagens digitais orbitais como base, surgiram como uma tentativa de aprimorar, não só a detecção da mudança em si, assim como de sua interpretação, agregando cada vez mais conteúdo de qualidade às análises. Alguns desses algoritmos visam a detecção de mudanças em áreas de floresta como é o caso do CCDC - Continuous Change Detection and Classification \citep{ZHU2014152}, COLD - Continuous Monitoring of Land Disturbance \citep{Cohen2020}, Landtrendr \citep{KENNEDY20102897, KENNEDY2012117}, VCT – Vegetation Change Tracker \citep{Huang2010, THOMAS201119}, EWMACD - Exponentially Weighted Moving Average Change Detection \citep{Brooks2014}, MIICA - Multi-index Integrated Change Analysis \citep{JIN2013159}, VerDET - Vegetation Regeneration and Disturbance Estimates through Time \citep{Hughes2017}, ITRA - Image Trends from Regression Analysis \citep{VOGELMANN201292} e o Shapes-NBR \citep{Meyer2013, Moisen2016}.

Pensando pela perspectiva temporal, é importante entender exatamente qual tipo de mudança se espera obter com a utilização desses algoritmos. Muitas das ferramentas já citadas possibilitam a detecção não somente de eventos de grande magnitude, mas também de processos de degradação que ocorreram ao longo de décadas, ou seja, processos de baixa magnitude, o que possibilita estudos mais elaborados, mas que ao mesmo tempo podem gerar resultados com mais ruído.

Como se pode imaginar, a limpeza dos dados na etapa de pós processamento desses algoritmos acaba sendo essencial para a obtenção de resultados de boa qualidade. É normal que pequenas variações na própria radiometria da imagem sejam detectadas como mudança. Apesar de ser possível retirar grande parte desse ruído considerando apenas mudanças com magnitudes mais altas, áreas de floresta que possuem alta declividade, por exemplo, tendem a sofrer mais com certos ruídos. Sendo assim, parte da limpeza desses dados normalmente acontece utilizando dados gerados por projetos como o Mapbiomas. Os dados do Mapbiomas podem ser utilizados como uma máscara para ignorar áreas de não interesse. Pixels que foram classificados em todos os anos do mapeamento do Mapbiomas como áreas urbanas, corpos d’água, pasto, solo exposto, agricultura e, claro, florestas, são binarizados e multiplicados entre si (classe a classe) para serem utilizados como máscaras com o objetivo de limpar possíveis ruídos no resultado final de um algoritmo como o Landtrendr \cite{KENNEDY2007370, KENNEDY20102897, Kennedy2018}. No entanto, os mapeamentos anuais do Mapbiomas entendem a classificação de forma anual, e não de forma multitemporal, o que pode implicar em erros quando a multiplicação das classificações é realizada para gerar as camadas binárias que servirão para limpar os ruídos. Um pixel que possa ter sido mapeado de forma equivocada em um único ano pode anular a inclusão desta mesma área como uma área a ser utilizada como máscara. Portanto, ao utilizarmos este método, somente áreas bem consolidadas acabam sendo selecionadas para limpar o resultado gerado pelo algoritmo de detecção de mudança.

Sendo assim, o presente trabalho buscou elaborar uma alternativa a esta técnica, apresentando uma forma mais precisa de gerar camadas de áreas de estabilidade, ou seja, áreas que apesar de terem sido afetadas por pequenas mudanças mantiveram alguma característica principal ao longo da série. O foco dado neste trabalho foi para a classe que chamamos aqui de florestas invariantes, já que normalmente é a classe de maior interesse e possivelmente a que possui maior quantidade de ruído associado. Diferentemente do método mais tradicional, a ideia foi realizar a criação de uma máscara gerada a partir da classificação de toda a série temporal e não da agregação de camadas classificadas individualmente ano a ano. 

\subsection{Metodologia}

\hspace{13pt} Para a realização deste trabalho utilizou-se como área de estudo o limite a APA da Bacia Hidrográfica do Rio São João (Figura \ref{fig:bhrsj}). A área foi escolhida por já possuir extenso número de trabalhos de referência publicados e por apresentar elementos da paisagem que representam de forma geral grande parte o contexto morfoclimático e fitogeográfico do Estado do Rio de Janeiro.

\begin{figure}[h!]
    \centering
    \includegraphics[scale=.5]{images/bhrsj_v2.png}
    \caption{O valor de biomassa chegou a ser ainda menor do que quando a maior perda foi registrada.}
    \label{fig:bhrsj}
\end{figure}

Inicialmente foi necessário gerar a camada de floresta invariante utilizando os dados do Mapbiomas. Ou seja, tudo que foi classificado como floresta durante todos os anos do mapeamento. Neste caso, floresta é tudo que foi classificado como “Formação Florestal” pelo Mapbiomas. Para isso, todas as camadas de uso do solo para o bioma da Mata Atlântica gerados pela série 4.1 do projeto (de 1985 até 2018, totalizando 33 camadas) foram recortados de acordo com os limites da APA e passaram por um processo de reclassificação, resultando em camadas binárias (floresta e não-floresta). Após a reclassificação, todas as camadas foram multiplicadas entre si resultando finalmente em uma camada binária final, onde florestas possuem com valor 1 e áreas de não-floresta valor 0.

Como a proposta metodológica consiste na aplicação de um algoritmo de classificação em toda a série temporal, foi essencial a coleta de boas amostras representativas de florestas invariantes. Boas amostras são essenciais para um resultado final satisfatório. Além disso, não seria prudente utilizar somente a camada do Mapbiomas para coletar tais amostras, já que a mesma seria posteriormente comparada com o resultado final. Sendo assim, além da utilização dos próprios dados do Mapbiomas, foi gerada uma imagem sintética do valor máximo de NDVI, considerando todos os anos da série temporal, de forma a realizar uma coleta de amostras através de uma abordagem mais conservadora.

A camada de máximo valor de NDVI foi toda desenvolvida utilizando a plataforma GEE. Para a geração dessa camada foram utilizadas todas as imagens disponíveis do satélite Landsat considerando as séries 5, 7 e 8. Foram utilizadas todas as imagens disponíveis para todos os três satélites presentes na coleção Surface Reflectance Tier 1 por já possuírem correção atmosférica (6S).

Após uma filtragem inicial, aplicou-se uma função em cada uma das imagens (datas) disponíveis, gerando-se uma imagem NDVI correspondente. Através de uma outra função retirou-se todos os pixels com presença de nuvens e sombras.

Com o conjunto total de imagens NDVI, extraiu-se para cada ano da série a mediana dos valores obtidos por pixel e, a partir do novo conjunto gerado, extraiu-se o valor máximo encontrado em toda a série. Desta forma, a camada final representou o valor máximo das medianas de cada ano. A escolha da mediana como um passo intermediário foi crucial para a eliminação de ruídos e valores inválidos presentes na série temporal, dado que o cálculo baseado apenas na extração dos valores máximos gera uma camada final com ruídos espalhados por toda a imagem.

Após a criação da camada de máximo valor de NDVI, buscou-se um limiar para o valor de corte do que poderíamos classificar como floresta. Considerando que os tipos de uso do solo que mais podem gerar confusão em uma classificação com áreas de floresta são as áreas de pastagem e agricultura, uma nova camada contendo somente essas duas classes foi gerada utilizando os mesmos dados do Mapbiomas com a mesma metodologia realizada anteriormente para as áreas de floresta.

Tanto a camada raster de florestas invariantes (Mapbiomas) como a de pasto/agricultura invariantes (Mapbiomas) foram transformadas em pontos (vetor), selecionando-se dois mil destes pontos de forma aleatória para a aplicação de um teste t de Student. A seleção de pontos de forma aleatória se deu desta forma para evitar um possível enviesamento espacial. A aplicação do teste t de Student resultou em um valor-p de 2.2e-16, apresentando, portanto, diferença significativa entre as duas amostras. Com isso é possível concluir que as amostras com os valores de NDVI de florestas tem alta chance de pertencerem a áreas de floresta. Sendo assim, uma função para extrair o valor mínimo presente nas duas mil amostras de florestas foi processada apresentando um valor de 0,83. O valor de 0,83 pode então ser utilizado como valor de limiar de corte (threshold) para a geração de camadas binárias. A multiplicação da camada binária de florestas invariantes do Mapbiomas com a camada binária de máximo NDVI (todos valores maiores que 0.83) serviu então como nossa camada para extração de pontos de floresta para o treinamento do modelo de classificação.

Já para a extração de pontos de florestas que apresentaram alguma mudança significativa, utilizou-se o resultado do algoritmo Landtrendr. A escolha deste algoritmo se deu à sua capacidade de detecção de eventos de baixa magnitude, o que em muitos casos significa a detecção de processos de degradação mais lentos e longos além claro da típica detecção de eventos de grande mudança. Dentre os muitos resultados que o algoritmo oferece, a camada escolhida foi o da detecção dos maiores eventos de perda de vegetação (Greatest Loss) utilizando imagens anuais de 1985 até 2018 e considerando todas as imagens disponíveis para cada ano no período de 1 de janeiro até 31 de dezembro. Como camada padrão utilizou-se o NDVI para o processamento do resultado final.

Após o Landtrendr apresentar o resultado com todas as maiores perdas detectadas, iniciou-se o processo de limpeza desses dados ao considerar apenas as mudanças com magnitudes maiores que 200, ou seja, perdas maiores que 0,2 no NDVI em um único evento. Nenhuma outra limitação foi imposta ao algoritmo e todos os outros parâmetros foram utilizados de forma padrão sem nenhuma modificação.

Já os pontos para a classe “outros” (água, solo exposto, pasto, etc.) foram coletados de forma aleatória utilizando a imagem resultante com todos os pixels que não tinham sido classificados anteriormente nem como floresta pela fusão da camada do Mapbiomas com o NDVI máximo, e nem pelos pixels detectados pelo Landtrendr como áreas com possível perda de vegetação.

Todas as amostras das três classes foram então importadas em formato shapefile para a plataforma do Google Earth Engine (GEE) para execução do processo de classificação utilizando o algoritmo Random Forest. Como imagem base para a classificação foi necessário ter uma série temporal com imagens anuais seguindo os mesmos padrões da série do Mapbiomas para possibilitar posterior comparação. Essa série de imagens foi gerada utilizando um script desenvolvido no GEE contendo, para cada ano, uma composição de valores considerando o valor da mediana de cada pixel para cada banda. Para cada ano foram utilizadas as bandas Blue, Green, Red, NIR, SWIR1, SWIR2 e também de índices como o NDVI, NDWI, NDMI, SAVI, Greenness, Wetness e Brightness. Áreas com nuvens e sombra foram mascaradas com valores “no data” e, portanto, não foram consideradas no cálculo da mediana.

No entanto, por se tratar de uma nova metodologia, antes de gerar o processo de classificação final utilizando as amostras coletadas, escolhemos realizar testes de validação cruzada (cross validation) para entender melhor quais variáveis (bandas) teriam o melhor desempenho ao classificar este tipo de classe. Utilizamos então as amostras coletadas (250 pontos/classe) para extrair os valores da série temporal e exportamos para um ambiente offline, já que atualmente não existem ferramentas de teste e validação suficientemente boas no GEE.

As tabelas com os valores das amostras foram processadas no pacote MLR (Machine Learning in R) (BISCHL, et al., 2016) utilizando o classificador Random Forest com 100 árvores cada e com a validação cruzada em modo “k-fold” utilizando parâmetro 10 (divide o subconjunto das amostras em 90\% treino e 10\% teste), repetindo ainda o processo por 100 iterações para cada teste, obtendo então um único valor de índice kappa por teste. Cada rodada aqui representa uma combinação de bandas a serem utilizadas pelo classificador para tentar separar as três classes. Para este teste foram consideradas 24 combinações diferentes de bandas. Aplicando o Random Forest para as 24 variações de entrada com o processo de validação cruzada utilizando 10 “folds” e 100 iterações para cada validação, foram gerados 24000 processos de classificação diferentes, com cada processo gerando 100 árvores de decisão (Figura \ref{fig:fluxograma}). Os resultados para essa quantidade exaustiva de testes são os apresentados na Tabela \ref{tab:1}:


\begin{table}[h!]
\centering
\rowcolors{2}{red!50!yellow!30}{green!40!yellow!10}
\footnotesize
\begin{tabular}{|c | c|}
\hline
                                                               BANDA &  Kappa \\
\hline
    Blue + Green + Red + NIR + SW1 + SW2 + NDVI + NDWI + NDMI + SAVI &  0.844754 \\
Blue + Green + Red + NIR + SW1 + SW2 + NDVI, NDWI + NDMI + SAVI + TC &  0.839872 \\
                                Blue + Green + Red + NIR + SW1 + SW2 &  0.838804 \\
                                            Blue + Green + Red + NIR &  0.833381 \\
                                                  Blue + Green + Red &  0.832774 \\
         Greeness + Wetness + Brightness + NDVI + NDWI + NDMI + SAVI &  0.829503 \\
                                                   NDVI + NIR + NDMI &  0.819875 \\
                                                          NDVI + NIR &  0.819833 \\
                                     Greeness + Wetness + Brightness &  0.812621 \\
                                                                 Red &  0.812496 \\
                                                               SWIR2 &  0.808915 \\
                                                              Green  &  0.805528 \\
                                                                Blue &  0.800079 \\
                                           NDVI + NDWI + NDMI + SAVI &  0.796679 \\
                                                         NDVI + NDMI &  0.783342 \\
                                                               SWIR1 &  0.778846 \\
                                                             Wetness &  0.767554 \\
                                                           Greenness &  0.761319 \\
                                                               NDVI  &  0.755475 \\
                                                                SAVI &  0.755282 \\
                                                          Brightness &  0.715955 \\
                                                                NDMI &  0.706022 \\
                                                                NDWI &  0.634395 \\
                                                                 NIR &  0.576071 \\
\hline
\end{tabular}
\caption{Índice Kappa para as Combinações de Variáveis Utilizadas. (SW1 = SWIR1, SW2 = SWIR2, TC = Tasseled Cap = Greeness, Wetness, Brightness)}
\label{tab:1}
\end{table}

\newpage

\begin{figure}[h!]
    \centering
    \includegraphics[scale=.4]{images/fluxograma.jpg}
    \caption{Fluxograma demonstrando o processo de validação cruzada. Todo o processo foi repetido para cada combinação de banda utilizada no estudo, totalizando 24 processos independentes.}
    \label{fig:fluxograma}
\end{figure}

É importante frisar que o processo de validação cruzada representa apenas uma etapa intermediária antes da classificação final que visa uma melhor escolha dos parâmetros ao verificar através de muitos testes qual combinação de variáveis obteve melhor resultado (menor erro).

Observa-se que a melhor combinação de bandas para o processo de classificação não é a simples utilização de todas as bandas. A incorporação do Tasseled Cap não trouxe uma melhoria na precisão do modelo. No entanto, a tabela de desempenho também apresenta outros resultados interessantes, como por exemplo a taxa de acerto utilizando apenas a banda do vermelho (Red) ou em como bandas que são tipicamente usadas pela comunidade de forma ampla para detecção de áreas vegetadas como o NDVI, NDMI e SAVI apresentaram resultados piores do que muitas outras combinações possíveis. 

\subsection{Resultados}

\hspace{13pt} Após a otimização do modelo, foi feita uma seleção na série temporal para utilizar apenas a combinação de bandas que obtiveram o melhor resultado (Blue, Green, Red, NIR, SWIR1, SWIR2, NDVI, NDMI, NDWI e SAVI) e assim gerar uma classificação final (Figura \ref{fig:bhrsj_class_final}). Como resultado obtivemos uma área total de florestas invariantes na APA, de 501,1km2.

\begin{figure}[h!]
    \centering
    \includegraphics[scale=.5]{images/bhrsj_class_final.png}
    \caption{Classificação final gerada no Google Earth Engine (Classificação final)}
    \label{fig:bhrsj_class_final}
\end{figure}

\newpage

As classes escolhidas para o mapeamento final foram “Floresta Invariante”, “Perda Landtrendr” e “Outros”. A classe “Floresta Invariante” representa todos os pixels que mantiveram algum grau de coerência espectral ao longo da série temporal. Mesmo com algumas variações ao longo do tempo, o classificador pode encontrar padrões e descartar anomalias da série. Este comportamento é importante justamente para descartar ruídos presentes em qualquer série temporal sem a necessidade da aplicação de outros algoritmos de pré-processamento e por já garantir um bom resultado. Já a classe “Perdas Landtrendr” foi fortemente influenciada pelo resultado do algoritmo Landtrendr que já tinha detectado os padrões de perda (loss) anteriormente. Ou seja, é importante garantir que o resultado do algoritmo de detecção de mudanças seja o melhor possível modificando seus parâmetros de acordo com a área de estudo. Por fim, a classe “Outros” representa todas as outras classes presentes na bacia e que foram agregadas para não gerar confusão com os objetivos do mapeamento. O resultado da classificação final foi bastante satisfatório, apresentando um padrão espacial das classes esperado para a área de estudo.

No entanto, além da classificação gerada, uma nova imagem teve de ser criada para a comparação entre o resultado obtido pelo Random Forest e a imagem binária utilizando somente dados do Mapbiomas. A nova imagem foi criada somando-se a camada de florestas invariantes com todos os anos do Mapbiomas com a versão binarizada do resultado final (florestas invariantes - outros).

Com essa imagem fusionada pode se notar que grande parte dos pixels (469,8km2 ou 76,9\% da área mapeada) foram classificados como floresta invariante tanto pelo Random Forest como pelo Mapbiomas. No entanto, diferenças como áreas onde somente o Random Forest classificou como floresta (22,7km2 ou 3,8\% da área mapeada) e onde somente o Mapbiomas classificou como floresta (52,7km2 ou 8,7\% da área mapeada) também foram detectadas. Os outros 10,8\% de área restantes foram excluídos da análise por não serem áreas de interesse.

Para entender melhor a qualidade de cada resultado, foram feitos alguns testes estatísticos. Primeiramente, foram selecionadas duas mil amostras aleatórias de três classes: Áreas que foram classificadas como floresta pelos dois mapeamentos (FOR), áreas que foram classificadas como floresta apenas pelo Random Forest (RF) e áreas que foram classificadas como floresta apenas pelo Mapbiomas (MB). Um teste de análise de variância (ANOVA) foi realizado para entender se os valores encontrados por cada amostra eram estatisticamente similares. O valor-p obtido pela ANOVA foi de 0,0116, o que mostrava uma diferença significativa entre as amostras considerando um limiar de valor-p de 0,05. Sendo assim, buscou-se então realizar um teste entre cada uma das amostras utilizando o teste de Tukey \citep{Tukey1949}. Os resultados são os apresentados na Tabela 2.

\begin{table}[h!]
    \centering
    \begin{tabular}{|c | c|}
    Combinação (Teste de Tukey) &  Valor-p      \\
                Mapbiomas - FOR &  8.489000e-04 \\
                       RF - FOR &  1.841643e-01 \\
                 RF - Mapbiomas &  2.000000e-07 \\
    \end{tabular}
    \caption{Resultados do Teste de Tukey}
    \label{tab:2}
\end{table}

Os resultados foram considerados promissores. Segundo o teste de Tukey, ao mesmo tempo em que as amostras que somente o Mapbiomas mapeou como floresta invariante são significativamente diferentes das que ambos os mapeamentos mapearam como floresta invariante. Já as amostras do Random Forest que são diferente das do Mapbiomas, quando comparadas com as mapeadas por ambos, são estatisticamente similares.

Este resultado mostra que a classificação feita pela metodologia proposta apresenta um resultado possivelmente superior a obtida utilizando somente as camadas do Mapbiomas. No entanto, ainda seria preciso saber o quanto de erro associado poderia existir, não apenas nas áreas mapeadas pelo Mapbiomas ou pelo Random Forest, mas também nas áreas em que ambos obtiveram o mesmo resultado.

Para este processo de validação final utilizamos a ferramenta TimeSync \citep{COHEN20102911}. Diferente do processo de validação comum nos mapeamentos de apenas uma ou poucas datas, a validação de séries temporais densas necessita de ferramentas especiais como o TimeSync, que apesar de ter utilização ainda consideravelmente complexa, é uma das únicas ferramentas existentes que realizam esse tipo de validação. 

O TimeSync funciona de forma integrada com o GEE e também necessita do software Access da Microsoft para armazenar as coordenadas de cada ponto a ser validado. A validação do TimeSync é feita de forma visual através da interface gráfica do programa.

Foram coletados para a etapa de validação no TimeSync trezentos pontos para cada uma das classes. Os pixels mapeados apenas pelo Mapbiomas tiveram uma taxa de acerto de 55\%, enquanto os pixels mapeados pelo Random Forest tiveram uma taxa de acerto de 76\%. Já os pixels mapeados por ambos tiveram um acerto de 97\%. Logo após, um último teste foi realizado considerando outras trezentas amostras do mapa final gerado pela nova metodologia, mas considerando apenas os pixels que foram classificados como floresta invariante, resultado em uma taxa de acerto final de 91,7\%. Todos os resultados, amostras, imagens, arquivos vetoriais, códigos e materiais para validação utilizados neste trabalho estão disponíveis para visualização e possível replicação através deste link: https://github.com/sacridini/florestas\_invariantes\_random\_forest.

\subsection{Conclusões}

\hspace{13pt} Através dos testes realizados neste trabalho podemos verificar que a metodologia proposta apresentou melhor desempenho se comparada à utilização da base de dados do Mapbiomas, quando o objetivo é gerar camadas de florestas que não sofreram nenhuma ou pouca variação ao longo de tempo. É importante lembrar que o Mapbiomas continua sendo uma excelente referência para estudos envolvendo séries temporais, e que a comparação feita visa obter resultados melhores para uma classe que não é oficialmente mapeada pelo projeto já que o mesmo possui objetivos distintos. Os resultados obtidos poderão ser utilizados como base para outros mapeamentos de áreas florestadas invariantes em ambientes tropicais. O trabalho buscou também contribuir para um melhor entendimento das variáveis que melhor conseguem separar classes tão novas como a proposta, já que ainda são poucos os trabalhos que buscam classificar séries temporais nessa escala. Além disso, resultados surpreendentes como o desempenho da banda do vermelho mostram que a utilização de apenas uma única banda pode ser o suficiente para a identificação de áreas similares e servem como um estímulo a novos estudos que visem a detecção de áreas invariantes de forma rápida e pouco custosa.

Máscaras de áreas invariantes como a gerada pelo algoritmo de aprendizado de máquina poderão servir, não só como parâmetros para estudos aplicados à conservação, mas também como máscaras para a limpeza de dados indesejados em resultados obtidos por algoritmos de detecção de mudanças como o Landtrendr e outros.

\newpage
% \section{Long-term (1985 – 2018) monitoring of forest cover changes in the Atlantic Forest using Landtrendr algorithm}
\section{Monitoramento de longo prazo (1985 – 2018) das mudanças florestais na Mata Atlântica utilizando o algoritmo Landtrendr}
\subsection{Introdução}
\hspace{13pt} Introdução.

\subsection{Materiais e Métodos}
\subsubsection{Área de estudo}
\hspace{13pt} O estudo abrange toda a área do bioma da Mata Atlântica brasileira, que possui atualmente uma área total de aproximadamente 1.1 Mkm2 ou 110 Mha. O bioma está presente em 15 estados brasileiros e é onde se localiza grande parte da atividade econômica e população do pais. Atualmente, vivem na Mata Atlântica cerca de 72\% da população brasileira (IBGE, 2014), o que em parte explica o fato de hoje apenas cerca de 12\% de sua cobertura natural ter persistido.. O bioma ainda possui 75,6\% das espécies ameaçadas e endêmicas do Brasil, o que o torna um dos mais prioritários para conservação no país. Além disso, estima-se que entre 43\% e 45\% do total de espécies de plantas e vertebrados sejam restritas a esse bioma.

Na época da chegada dos portugueses no Brasil, a Mata Atlântica cobria cerca de 1,5 milhões de quilômetros quadrados, estendendo-se ao longo de 3 mil quilômetros da costa brasileira - do Rio Grande do Sul ao Rio Grande do Norte - e penetrando pelo interior, cruzando São Paulo, Minas Gerais e Mato Grosso do Sul até as fronteiras da Argentina e do Paraguai \citep{scarano2014}. Cerca de 500 anos depois, esse extenso e representativo bioma abriga mais de 100 milhões de pessoas, cerca de 1/4 das quais ainda vivem na pobreza \citep{scarano2014}.

Segundo o projeto Mapbiomas, a área total de florestas no bioma em 1985 era de X e em 2018 de X. Já a área de florestas que não sofreram mudanças significativas (pseudo-invariantes) durante o período de 1985 até 2018 foi de aproximadamente 21.4Mha. Deste total, somente  30\% da vegetação nativa remanescente está protegida legalmente através de unidades de conservação.

% Apesar dos importantes avanços obtidos nesta agenda na última década – como a restauração de aproximadamente 1,4 milhões de hectares entre 2011 e 2020 – muito ainda precisa ser feito \citep{CROUZEILLES2019}

\subsubsection{Dados de entrada}
\hspace{13pt} Para este estudo foram utilizadas todas as imagens Landsat 5, 7 e 8 disponíveis entre 1985 e 2018 ao longo das 88 cenas Landsat necessárias para cobrir todos os 110 Mha de extensão do bioma. Todas as imagens utilizadas são da coleção \emph{surface reflectance} e passaram por processo de harmonização para evitar acúmulo de ruídos. As séries temporais foram criadas utilizando uma função própria do Landtrendr.


\subsubsection{Método de análise}
\hspace{13pt} A análise das trajetórias foi feita utilizando o algoritmo Landtrendr em sua versão para a plataforma Google Earth Engine (GEE) \citep{Kennedy2018}. As vantagens da implementação do algoritmo no GEE em relação a sua versão original em ENVI/IDL está na possibilidade de sua aplicação em áreas extensas. Além disso, a versão para GEE elimina grande parte dos desafios técnicos presentes em sua implementação clássica. No entanto, apesar do ganho significativo no tempo de processamento quando comparado a sua versão em IDL, o Landtrendr GEE também apresenta algumas limitações. Uma das maiores está na limitação na extensão da análise para apenas uma imagem Landsat por vez. A plataforma apresentou erros sistemáticos quando foi requisitada para processar análises para toda a Mata Atlântica de uma só vez, por exemplo. Com isso, o processamento teve de ser feito em etapas. 

Com isso, as etapas tiveram de ser divididas por cenas Landsat, neste caso, 88 cenas. Como o resultado do algoritmo é dado de forma separada por cena, foi necessário juntar todas as camadas geradas em uma única em uma etapa extra de pós-processamento. Devido a ruídos presentes nas bordas das imagens Landsat e a sobreposição natural entre imagens diferentes, nem todos os pixels presentes nas bordas apresentaram resultados similares. Juntar todos as 88 camadas de resultados em uma se tornou um desafio e só foi possível através criação de polígonos de voronoi \citep{Okabe}, o que possibilitou utilizarmos somente as áreas mais próximas do centro das camadas geradas pelo algoritmo. 

Os polígonos de voronoi foram gerados através da extração dos centroides dos polígonos delimitadores das cenas Landsat e posteriormente utilizados para a criação dos polígonos com as áreas centrais. Após a geração dos polígonos de voronoi, o mesmos foram utilizados para recordar os resultados de forma a limpar possíveis sobreposições. Após o recorte, todas as imagens foram agregadas para toda extensão do bioma e separadas banda a banda para análise posterior.

% Mapa duplo com shapefiles dos pathrows e com os voronoi (?)

Tanto resultados para o cenário de perda quanto de ganho foram gerados com o objetivo de detectar supressões e processos de degradação como também de restauração e regeneração da floresta. Para este estudo, o Landtrendr foi aplicado utilizando todos seus parâmetros padrões.

\subsubsection{Processamento dos cenários de ganho}
\hspace{13pt} Para o cenário de ganho, todos os parâmetros padrão do algoritmo foram mantidos sem nenhum tipo de restrição. Cenários de magnitude, valor prévio, ano de detecção, duração e taxa forma gerados e posteriormente pós-processados para limpeza de ruídos ou para retirada de valores indesejados. 

Primeiramente, foi gerado uma máscara com todas as áreas pseudo-invariantes entre os anos da análise (1985 - 2018) com o intuito de limpar detecções de mudança muito pequenas. Além disso, foram mascarados também todos os eventos com duração menor ou igual a 4 anos, já que não gostaríamos de incorporar eventos ainda muito recentes que poderiam ser identificados como falsos eventos de mudança. O valor mínimo de 5 anos para eventos de ganho ajuda a identificar apenas eventos mais longos que tiveram tempo de apresentar respostas espectrais significativas de recuperação. Com 5 anos a vegetação já passa a apresentar um estágio sucessional característico de floresta secundária inicial. 

\subsubsection{Processamento dos cenários de perda}
\hspace{13pt} Assim como o cenário de ganho, o processamento do cenário de perda utilizou todos os parâmetros padrões do algoritmo sem nenhum tipo de restrição com o objetivo de realizar limpezas nos resultados obtidos em uma etapa de pós-processamento.

No caso das perdas, 

\subsubsection{Validação}

\subsubsection{Resultados}


\newpage
\bibliographystyle{abbrv}
%\bibliographystyle{apalike}
\bibliography{bibliography.bib}
\end{document}

    